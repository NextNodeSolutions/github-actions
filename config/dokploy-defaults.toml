# NextNode Default Configuration for Dokploy Deployments
# Projects only need to override what differs from these defaults

# =============================================================================
# CLUSTER CONFIGURATION (Docker Swarm)
# =============================================================================
[cluster]
# Traefik ingress server - all DNS records point here
# In Swarm mode, Traefik routes traffic to services on worker nodes
traefik-server = "admin-dokploy"

# =============================================================================
# BUILD CONFIGURATION
# =============================================================================
[build]
type = "dockerfile"           # dockerfile | nixpacks | buildpacks | static
dockerfile = "Dockerfile"
context = "."
target = ""                   # Multi-stage build target (optional)

# =============================================================================
# RESOURCE DEFAULTS
# =============================================================================
[resources]
memory = "512Mi"
cpu = 0.5
memory_limit = "1Gi"          # Hard limit
cpu_limit = 1                 # Hard limit

# =============================================================================
# HEALTH CHECK DEFAULTS
# =============================================================================
[healthcheck]
enabled = true
path = "/health"
port = 3000
interval = 30                 # seconds
timeout = 10                  # seconds
retries = 3
start_period = 40             # seconds

# =============================================================================
# DEPLOYMENT DEFAULTS
# =============================================================================
[deploy]
restart_policy = "unless-stopped"
rollback_on_failure = true

# =============================================================================
# VPS DEFAULTS (for custom dedicated servers)
# =============================================================================
[vps]
enabled = false
type = "cpx21"                # Hetzner: cpx11, cpx21, cpx31, cpx41, cpx51
location = "fsn1"             # fsn1 (Falkenstein), nbg1 (Nuremberg), hel1 (Helsinki)
# When enabled, worker name is auto-generated as {project-name}-worker

# =============================================================================
# SERVICES DEFAULTS (future - not yet implemented)
# =============================================================================
[services.postgres]
enabled = false
version = "16"
size = "small"                # small (1GB), medium (4GB), large (8GB)

[services.redis]
enabled = false
version = "7"
size = "small"

[services.minio]
enabled = false
bucket = "uploads"

# =============================================================================
# ENVIRONMENT: DEVELOPMENT
# Domain: dev.{project.domain}
# =============================================================================
[environments.development]
enabled = true
server = "dev-worker"
replicas = 1
auto_deploy = true

# =============================================================================
# ENVIRONMENT: PREVIEW (PR deployments)
# Domain: pr-{number}.{project.domain}
# Requires project.domain to be set
# =============================================================================
[environments.preview]
enabled = true
server = "dev-worker"
replicas = 1
auto_deploy = true
cleanup_on_merge = true

# =============================================================================
# ENVIRONMENT: PRODUCTION
# Domain: {project.domain}
# =============================================================================
[environments.production]
server = "prod-worker"
replicas = 1
auto_deploy = false           # Manual deploy for prod
